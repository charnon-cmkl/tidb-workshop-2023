[2023/08/29 15:41:22.468 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:41:22.480 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:41:40.836 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:41:40.837 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:42:18.410 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:42:18.412 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:42:55.923 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:42:55.924 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:43:11.659 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:43:11.660 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:43:23.796 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:43:23.796 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:45:39.852 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:45:39.853 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'./misc/HRDataset': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'./misc/HRDataset': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:46:06.566 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:46:06.566 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:46:06.567 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693298766566480000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"local\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/sorted-kv-dir-1\",\"disk-quota\":9223372036854775807,\"range-concurrency\":16,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"required\",\"analyze\":\"optional\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:46:06.580 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:46:06.581 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:46:06.581 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:46:06.581 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=1.604399ms] []
[2023/08/29 15:46:06.582 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:46:06.602 +07:00] [ERROR] [lightning.go:531] ["restore failed"] [error="[Lightning:Config:ErrInvalidSortedKVDir]invalid sorted-kv-dir '../stage/sorted-kv-dir-1' for local backend, please change the config or delete the path: mkdir ../stage/sorted-kv-dir-1: no such file or directory"]
[2023/08/29 15:46:06.602 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidSortedKVDir]invalid sorted-kv-dir '../stage/sorted-kv-dir-1' for local backend, please change the config or delete the path: mkdir ../stage/sorted-kv-dir-1: no such file or directory"] [errorVerbose="[Lightning:Config:ErrInvalidSortedKVDir]invalid sorted-kv-dir '../stage/sorted-kv-dir-1' for local backend, please change the config or delete the path: mkdir ../stage/sorted-kv-dir-1: no such file or directory\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStackByArgs\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:164\ngithub.com/pingcap/tidb/br/pkg/lightning/backend/local.NewLocalBackend\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/backend/local/local.go:438\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.NewRestoreControllerWithPauser\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:356\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.NewRestoreController\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:277\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).run\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:529\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:373\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:46:23.905 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:46:23.905 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]tikv-importer.sorted-kv-dir must not be empty!"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]tikv-importer.sorted-kv-dir must not be empty!\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustForLocalBackend\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:992\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).AdjustCommon\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:961\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:898\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:47:01.357 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:47:01.357 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]tikv-importer.sorted-kv-dir must not be empty!"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]tikv-importer.sorted-kv-dir must not be empty!\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustForLocalBackend\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:992\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).AdjustCommon\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:961\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:898\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:48:44.402 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:48:44.403 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:48:44.403 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693298924403502000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"local\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/\",\"disk-quota\":9223372036854775807,\"range-concurrency\":16,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"required\",\"analyze\":\"optional\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:48:44.408 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:48:44.409 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:48:44.409 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:48:44.409 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=1.013857ms] []
[2023/08/29 15:48:44.410 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:48:44.433 +07:00] [INFO] [local.go:593] ["multi ingest support"]
[2023/08/29 15:48:44.433 +07:00] [INFO] [restore.go:461] ["the whole procedure start"]
[2023/08/29 15:48:44.436 +07:00] [INFO] [restore.go:2008] [new_collation_enabled] [enabled=true]
[2023/08/29 15:48:44.436 +07:00] [INFO] [restore.go:769] ["restore all schema start"]
[2023/08/29 15:48:44.436 +07:00] [INFO] [restore.go:785] ["restore all schema completed"] [takeTime=46.195µs] []
[2023/08/29 15:48:44.455 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 15:48:44.456 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 15:48:44.459 +07:00] [ERROR] [restore.go:479] ["run failed"] [step=2] [error="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory"]
[2023/08/29 15:48:44.459 +07:00] [ERROR] [restore.go:489] ["the whole procedure failed"] [takeTime=25.474635ms] [error="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory"]
[2023/08/29 15:48:44.460 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory"] [errorVerbose="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStackByArgs\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:164\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.(*Controller).preCheckRequirements\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:2131\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.(*Controller).Run\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:467\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).run\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:536\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:373\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:49:18.158 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:49:18.158 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:49:18.158 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693298958158562000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"local\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/sorted-kv-dir-1\",\"disk-quota\":9223372036854775807,\"range-concurrency\":16,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"required\",\"analyze\":\"optional\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:49:18.163 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:49:18.163 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:49:18.163 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:49:18.163 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=446.046µs] []
[2023/08/29 15:49:18.163 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:49:18.167 +07:00] [ERROR] [lightning.go:531] ["restore failed"] [error="[Lightning:Config:ErrInvalidSortedKVDir]invalid sorted-kv-dir '../stage/sorted-kv-dir-1' for local backend, please change the config or delete the path: mkdir ../stage/sorted-kv-dir-1: no such file or directory"]
[2023/08/29 15:49:18.168 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidSortedKVDir]invalid sorted-kv-dir '../stage/sorted-kv-dir-1' for local backend, please change the config or delete the path: mkdir ../stage/sorted-kv-dir-1: no such file or directory"] [errorVerbose="[Lightning:Config:ErrInvalidSortedKVDir]invalid sorted-kv-dir '../stage/sorted-kv-dir-1' for local backend, please change the config or delete the path: mkdir ../stage/sorted-kv-dir-1: no such file or directory\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStackByArgs\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:164\ngithub.com/pingcap/tidb/br/pkg/lightning/backend/local.NewLocalBackend\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/backend/local/local.go:438\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.NewRestoreControllerWithPauser\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:356\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.NewRestoreController\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:277\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).run\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:529\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:373\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:49:41.003 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:49:41.003 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:49:41.003 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693298981003554000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"local\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/\",\"disk-quota\":9223372036854775807,\"range-concurrency\":16,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"required\",\"analyze\":\"optional\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:49:41.008 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:49:41.010 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:49:41.010 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:49:41.010 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=1.920982ms] []
[2023/08/29 15:49:41.010 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:49:41.024 +07:00] [INFO] [local.go:593] ["multi ingest support"]
[2023/08/29 15:49:41.024 +07:00] [INFO] [restore.go:461] ["the whole procedure start"]
[2023/08/29 15:49:41.025 +07:00] [INFO] [restore.go:2008] [new_collation_enabled] [enabled=true]
[2023/08/29 15:49:41.025 +07:00] [INFO] [restore.go:769] ["restore all schema start"]
[2023/08/29 15:49:41.025 +07:00] [INFO] [restore.go:785] ["restore all schema completed"] [takeTime=23.355µs] []
[2023/08/29 15:49:41.037 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 15:49:41.038 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 15:49:41.040 +07:00] [ERROR] [restore.go:479] ["run failed"] [step=2] [error="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory"]
[2023/08/29 15:49:41.041 +07:00] [ERROR] [restore.go:489] ["the whole procedure failed"] [takeTime=16.564647ms] [error="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory"]
[2023/08/29 15:49:41.041 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory"] [errorVerbose="[Lightning:PreCheck:ErrCheckLocalResource]check local storage resource error: no such file or directory\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStackByArgs\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:164\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.(*Controller).preCheckRequirements\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:2131\ngithub.com/pingcap/tidb/br/pkg/lightning/restore.(*Controller).Run\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/restore/restore.go:467\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).run\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:536\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:373\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:50:06.098 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:50:06.098 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:50:06.098 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693299006098388000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"tidb\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/sorted-kv-dir-1\",\"disk-quota\":9223372036854775807,\"range-concurrency\":0,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"off\",\"analyze\":\"off\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:50:06.104 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:50:06.104 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:50:06.104 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:50:06.104 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=452.652µs] []
[2023/08/29 15:50:06.104 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:50:06.105 +07:00] [INFO] [restore.go:461] ["the whole procedure start"]
[2023/08/29 15:50:06.105 +07:00] [INFO] [restore.go:769] ["restore all schema start"]
[2023/08/29 15:50:06.105 +07:00] [INFO] [restore.go:785] ["restore all schema completed"] [takeTime=22.784µs] []
[2023/08/29 15:50:06.114 +07:00] [INFO] [tidb.go:239] ["skipping check requirements for tidb backend"]
[2023/08/29 15:50:06.117 +07:00] [INFO] [restore.go:1437] ["restore all tables data start"]
[2023/08/29 15:50:06.118 +07:00] [INFO] [restore.go:1322] ["cancel periodic actions"] [do=false]
[2023/08/29 15:50:06.118 +07:00] [INFO] [restore.go:1545] ["restore all tables data completed"] [takeTime=628.425µs] []
[2023/08/29 15:50:06.118 +07:00] [INFO] [restore.go:1842] ["skip full compaction"]
[2023/08/29 15:50:06.119 +07:00] [INFO] [restore.go:2031] ["clean checkpoints start"] [keepAfterSuccess=remove] [taskID=1693299006098388000]
[2023/08/29 15:50:06.119 +07:00] [INFO] [restore.go:2039] ["clean checkpoints completed"] [keepAfterSuccess=remove] [taskID=1693299006098388000] [takeTime=129.401µs] []
[2023/08/29 15:50:06.119 +07:00] [INFO] [restore.go:489] ["the whole procedure completed"] [takeTime=13.763426ms] []
[2023/08/29 15:50:06.119 +07:00] [INFO] [main.go:106] ["tidb lightning exit"] [finished=true]
[2023/08/29 15:51:12.244 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:51:12.244 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:51:12.244 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693299072244381000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"tidb\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/sorted-kv-dir-1\",\"disk-quota\":9223372036854775807,\"range-concurrency\":0,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"off\",\"analyze\":\"off\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:51:12.250 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:51:12.250 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:51:12.250 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:51:12.251 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=347.176µs] []
[2023/08/29 15:51:12.251 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:51:12.251 +07:00] [INFO] [restore.go:461] ["the whole procedure start"]
[2023/08/29 15:51:12.251 +07:00] [INFO] [restore.go:769] ["restore all schema start"]
[2023/08/29 15:51:12.251 +07:00] [INFO] [restore.go:785] ["restore all schema completed"] [takeTime=23.195µs] []
[2023/08/29 15:51:12.257 +07:00] [INFO] [tidb.go:239] ["skipping check requirements for tidb backend"]
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:1437] ["restore all tables data start"]
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:1322] ["cancel periodic actions"] [do=false]
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:1545] ["restore all tables data completed"] [takeTime=80.55µs] []
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:1842] ["skip full compaction"]
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:2031] ["clean checkpoints start"] [keepAfterSuccess=remove] [taskID=1693299072244381000]
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:1184] ["everything imported, stopping periodic actions"]
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:2039] ["clean checkpoints completed"] [keepAfterSuccess=remove] [taskID=1693299072244381000] [takeTime=125.959µs] []
[2023/08/29 15:51:12.258 +07:00] [INFO] [restore.go:489] ["the whole procedure completed"] [takeTime=7.643618ms] []
[2023/08/29 15:51:12.258 +07:00] [INFO] [main.go:106] ["tidb lightning exit"] [finished=true]
[2023/08/29 15:52:10.560 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:52:10.560 +07:00] [ERROR] [main.go:103] ["tidb lightning encountered error stack info"] [error="[Lightning:Config:ErrInvalidConfig]'./misc/HRDataset.csv': `mydumper.data-source-dir` does not exist"] [errorVerbose="[Lightning:Config:ErrInvalidConfig]'./misc/HRDataset.csv': `mydumper.data-source-dir` does not exist\ngithub.com/pingcap/errors.AddStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\ngithub.com/pingcap/errors.(*Error).GenWithStack\n\t/Users/pingcap/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/normalize.go:155\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).CheckAndAdjustFilePath\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:1106\ngithub.com/pingcap/tidb/br/pkg/lightning/config.(*Config).Adjust\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/config/config.go:925\ngithub.com/pingcap/tidb/br/pkg/lightning.(*Lightning).RunOnceWithOptions\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/pkg/lightning/lightning.go:364\nmain.main.func2\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:94\nmain.main\n\t/Users/pingcap/workspace/build-common/go/src/github.com/pingcap/br/br/cmd/tidb-lightning/main.go:95\nruntime.main\n\t/usr/local/go1.19.5/src/runtime/proc.go:250\nruntime.goexit\n\t/usr/local/go1.19.5/src/runtime/asm_amd64.s:1594"]
[2023/08/29 15:59:23.071 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 15:59:23.092 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 15:59:23.099 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693299563092893000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"tidb\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/sorted-kv-dir-1\",\"disk-quota\":9223372036854775807,\"range-concurrency\":0,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"off\",\"analyze\":\"off\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 15:59:23.125 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 15:59:23.138 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=HRDataset.csv]
[2023/08/29 15:59:23.146 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-database-create.sql]
[2023/08/29 15:59:23.146 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-create.sql]
[2023/08/29 15:59:23.147 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 15:59:23.147 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=12.353533ms] []
[2023/08/29 15:59:23.147 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 15:59:23.149 +07:00] [INFO] [restore.go:461] ["the whole procedure start"]
[2023/08/29 15:59:23.150 +07:00] [INFO] [restore.go:769] ["restore all schema start"]
[2023/08/29 15:59:23.150 +07:00] [INFO] [restore.go:785] ["restore all schema completed"] [takeTime=260.083µs] []
[2023/08/29 15:59:23.158 +07:00] [INFO] [tidb.go:239] ["skipping check requirements for tidb backend"]
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:1437] ["restore all tables data start"]
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:1322] ["cancel periodic actions"] [do=false]
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:1545] ["restore all tables data completed"] [takeTime=372.265µs] []
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:1842] ["skip full compaction"]
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:2031] ["clean checkpoints start"] [keepAfterSuccess=remove] [taskID=1693299563092893000]
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:2039] ["clean checkpoints completed"] [keepAfterSuccess=remove] [taskID=1693299563092893000] [takeTime=99.17µs] []
[2023/08/29 15:59:23.161 +07:00] [INFO] [restore.go:489] ["the whole procedure completed"] [takeTime=11.27299ms] []
[2023/08/29 15:59:23.161 +07:00] [INFO] [main.go:106] ["tidb lightning exit"] [finished=true]
[2023/08/29 16:51:58.151 +07:00] [WARN] [config.go:831] ["currently only per-task configuration can be applied, global configuration changes can only be made on startup"] ["global config changes"="[lightning.level,lightning.file]"]
[2023/08/29 16:51:58.152 +07:00] [INFO] [info.go:49] ["Welcome to TiDB-Lightning"] [release-version=v6.5.1] [git-hash=4084b077d615f9dc0a41cf2e30bc6e1a02332df2] [git-branch=heads/refs/tags/v6.5.1] [go-version=go1.19.5] [utc-build-time="2023-03-07 16:05:18"] [race-enabled=false]
[2023/08/29 16:51:58.152 +07:00] [INFO] [lightning.go:383] [cfg] [cfg="{\"id\":1693302718152315000,\"lightning\":{\"table-concurrency\":1,\"index-concurrency\":1,\"region-concurrency\":1,\"io-concurrency\":1,\"check-requirements\":true,\"meta-schema-name\":\"lightning_metadata\",\"max-error\":{\"type\":0},\"task-info-schema-name\":\"lightning_task_info\"},\"tidb\":{\"host\":\"127.0.0.1\",\"port\":4000,\"user\":\"imp\",\"status-port\":10080,\"pd-addr\":\"127.0.0.1:2379\",\"sql-mode\":\"ONLY_FULL_GROUP_BY,NO_AUTO_CREATE_USER\",\"tls\":\"false\",\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"max-allowed-packet\":67108864,\"distsql-scan-concurrency\":15,\"build-stats-concurrency\":20,\"index-serial-scan-concurrency\":20,\"checksum-table-concurrency\":2,\"vars\":null},\"checkpoint\":{\"schema\":\"tidb_lightning_checkpoint\",\"driver\":\"file\",\"enable\":true,\"keep-after-success\":\"remove\"},\"mydumper\":{\"read-block-size\":65536,\"batch-size\":0,\"batch-import-ratio\":0,\"source-id\":\"\",\"data-source-dir\":\"file:///Users/chnpat/Documents/Work/CMKL/Teaching/Training:Workshop/2023%20-%20TiDB%20Workshop/tidb-workshop-2023/exercises/scripts/misc\",\"character-set\":\"auto\",\"csv\":{\"separator\":\",\",\"delimiter\":\"\\\"\",\"terminator\":\"\",\"null\":\"\\\\N\",\"header\":true,\"trim-last-separator\":false,\"not-null\":false,\"backslash-escape\":true},\"max-region-size\":268435456,\"filter\":[\"*.*\",\"!mysql.*\",\"!sys.*\",\"!INFORMATION_SCHEMA.*\",\"!PERFORMANCE_SCHEMA.*\",\"!METRICS_SCHEMA.*\",\"!INSPECTION_SCHEMA.*\"],\"files\":null,\"no-schema\":false,\"case-sensitive\":false,\"strict-format\":true,\"default-file-rules\":true,\"ignore-data-columns\":null,\"data-character-set\":\"binary\",\"data-invalid-char-replace\":\"�\"},\"tikv-importer\":{\"addr\":\"\",\"backend\":\"tidb\",\"on-duplicate\":\"replace\",\"max-kv-pairs\":4096,\"send-kv-pairs\":32768,\"region-split-size\":0,\"region-split-keys\":0,\"sorted-kv-dir\":\"../stage/sorted-kv-dir-1\",\"disk-quota\":9223372036854775807,\"range-concurrency\":0,\"duplicate-resolution\":\"none\",\"incremental-import\":false,\"engine-mem-cache-size\":536870912,\"local-writer-mem-cache-size\":134217728,\"store-write-bwlimit\":0},\"post-restore\":{\"checksum\":\"off\",\"analyze\":\"off\",\"level-1-compact\":false,\"post-process-at-last\":true,\"compact\":false},\"cron\":{\"switch-mode\":\"5m0s\",\"log-progress\":\"5m0s\",\"check-disk-quota\":\"1m0s\"},\"routes\":null,\"security\":{\"ca-path\":\"\",\"cert-path\":\"\",\"key-path\":\"\",\"redact-info-log\":false},\"black-white-list\":{\"do-tables\":null,\"do-dbs\":null,\"ignore-tables\":null,\"ignore-dbs\":null}}"]
[2023/08/29 16:51:58.158 +07:00] [INFO] [lightning.go:495] ["load data source start"]
[2023/08/29 16:51:58.159 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-database-create.sql]
[2023/08/29 16:51:58.159 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-create.sql]
[2023/08/29 16:51:58.159 +07:00] [INFO] [loader.go:450] ["[loader] file is filtered by file router"] [path=ex2-hrd-table-import.toml]
[2023/08/29 16:51:58.160 +07:00] [INFO] [lightning.go:498] ["load data source completed"] [takeTime=1.082622ms] []
[2023/08/29 16:51:58.160 +07:00] [INFO] [checkpoints.go:1037] ["open checkpoint file failed, going to create a new one"] [path=/tmp/tidb_lightning_checkpoint.pb] []
[2023/08/29 16:51:58.161 +07:00] [INFO] [restore.go:461] ["the whole procedure start"]
[2023/08/29 16:51:58.162 +07:00] [INFO] [restore.go:769] ["restore all schema start"]
[2023/08/29 16:51:58.171 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 16:51:58.201 +07:00] [INFO] [restore.go:785] ["restore all schema completed"] [takeTime=38.958282ms] []
[2023/08/29 16:51:58.201 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 16:51:58.226 +07:00] [INFO] [tidb.go:239] ["skipping check requirements for tidb backend"]
[2023/08/29 16:51:58.227 +07:00] [INFO] [restore.go:1437] ["restore all tables data start"]
[2023/08/29 16:51:58.228 +07:00] [INFO] [restore.go:1570] ["restore table start"] [table=`Workshop`.`Employee`]
[2023/08/29 16:51:58.228 +07:00] [INFO] [table_restore.go:98] ["load engines and files start"] [table=`Workshop`.`Employee`]
[2023/08/29 16:51:58.228 +07:00] [INFO] [region.go:257] [makeTableRegions] [filesCount=1] [MaxRegionSize=268435456] [RegionsCount=1] [BatchSize=107374182400] [cost=37.726µs]
[2023/08/29 16:51:58.228 +07:00] [INFO] [table_restore.go:140] ["load engines and files completed"] [table=`Workshop`.`Employee`] [enginesCnt=2] [filesCnt=1] [takeTime=61.361µs] []
[2023/08/29 16:51:58.228 +07:00] [INFO] [version.go:423] ["detect server version"] [type=TiDB] [version=6.5.1]
[2023/08/29 16:51:58.229 +07:00] [INFO] [backend.go:360] ["open engine"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f]
[2023/08/29 16:51:58.229 +07:00] [INFO] [table_restore.go:277] ["import whole table start"] [table=`Workshop`.`Employee`]
[2023/08/29 16:51:58.229 +07:00] [INFO] [table_restore.go:324] ["restore engine start"] [table=`Workshop`.`Employee`] [engineNumber=0]
[2023/08/29 16:51:58.229 +07:00] [INFO] [table_restore.go:453] ["encode kv data and write start"] [table=`Workshop`.`Employee`] [engineNumber=0]
[2023/08/29 16:51:58.229 +07:00] [INFO] [backend.go:360] ["open engine"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290]
[2023/08/29 16:51:58.230 +07:00] [INFO] [restore.go:2785] ["restore file start"] [table=`Workshop`.`Employee`] [engineNumber=0] [fileIndex=0] [path=Workshop.Employee.csv:0]
[2023/08/29 16:51:58.303 +07:00] [INFO] [restore.go:2792] ["restore file completed"] [table=`Workshop`.`Employee`] [engineNumber=0] [fileIndex=0] [path=Workshop.Employee.csv:0] [readDur=1.166693ms] [encodeDur=1.119287ms] [deliverDur=70.719461ms] [checksum="{cksum=0,size=101491,kvs=311}"] [takeTime=73.231589ms] []
[2023/08/29 16:51:58.303 +07:00] [INFO] [table_restore.go:628] ["encode kv data and write completed"] [table=`Workshop`.`Employee`] [engineNumber=0] [read=0] [written=101491] [takeTime=74.327507ms] []
[2023/08/29 16:51:58.304 +07:00] [INFO] [backend.go:462] ["engine close start"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290]
[2023/08/29 16:51:58.304 +07:00] [INFO] [backend.go:464] ["engine close completed"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290] [takeTime=840ns] []
[2023/08/29 16:51:58.304 +07:00] [INFO] [table_restore.go:326] ["restore engine completed"] [table=`Workshop`.`Employee`] [engineNumber=0] [takeTime=75.387401ms] []
[2023/08/29 16:51:58.305 +07:00] [INFO] [table_restore.go:990] ["import and cleanup engine start"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290]
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:476] ["import start"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290] [retryCnt=0]
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:479] ["import completed"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290] [retryCnt=0] [takeTime=700ns] []
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:491] ["cleanup start"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290]
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:493] ["cleanup completed"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290] [takeTime=359ns] []
[2023/08/29 16:51:58.305 +07:00] [INFO] [table_restore.go:1020] ["import and cleanup engine completed"] [engineTag=`Workshop`.`Employee`:0] [engineUUID=9dee1833-9b2b-56c2-ae04-2c7e3e9ec290] [takeTime=364.863µs] []
[2023/08/29 16:51:58.305 +07:00] [INFO] [table_restore.go:352] ["import whole table completed"] [table=`Workshop`.`Employee`] [takeTime=75.857483ms] []
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:462] ["engine close start"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f]
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:464] ["engine close completed"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f] [takeTime=174ns] []
[2023/08/29 16:51:58.305 +07:00] [INFO] [table_restore.go:990] ["import and cleanup engine start"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f]
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:476] ["import start"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f] [retryCnt=0]
[2023/08/29 16:51:58.305 +07:00] [INFO] [backend.go:479] ["import completed"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f] [retryCnt=0] [takeTime=493ns] []
[2023/08/29 16:51:58.306 +07:00] [INFO] [backend.go:491] ["cleanup start"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f]
[2023/08/29 16:51:58.306 +07:00] [INFO] [backend.go:493] ["cleanup completed"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f] [takeTime=355ns] []
[2023/08/29 16:51:58.306 +07:00] [INFO] [table_restore.go:1020] ["import and cleanup engine completed"] [engineTag=`Workshop`.`Employee`:-1] [engineUUID=78b10e5e-82ff-5742-ba35-63a04c3a158f] [takeTime=348.544µs] []
[2023/08/29 16:51:58.306 +07:00] [INFO] [tidb.go:388] ["alter table auto_increment start"] [table=`Workshop`.`Employee`] [auto_increment=1]
[2023/08/29 16:51:59.061 +07:00] [INFO] [tidb.go:390] ["alter table auto_increment completed"] [table=`Workshop`.`Employee`] [auto_increment=1] [takeTime=755.154811ms] []
[2023/08/29 16:51:59.062 +07:00] [INFO] [restore.go:1576] ["restore table completed"] [table=`Workshop`.`Employee`] [takeTime=834.360439ms] []
[2023/08/29 16:51:59.062 +07:00] [INFO] [restore.go:1322] ["cancel periodic actions"] [do=false]
[2023/08/29 16:51:59.062 +07:00] [INFO] [restore.go:1545] ["restore all tables data completed"] [takeTime=835.231077ms] []
[2023/08/29 16:51:59.062 +07:00] [INFO] [restore.go:1842] ["skip full compaction"]
[2023/08/29 16:51:59.062 +07:00] [INFO] [restore.go:1184] ["everything imported, stopping periodic actions"]
[2023/08/29 16:51:59.062 +07:00] [INFO] [restore.go:2031] ["clean checkpoints start"] [keepAfterSuccess=remove] [taskID=1693302718152315000]
[2023/08/29 16:51:59.063 +07:00] [INFO] [restore.go:2039] ["clean checkpoints completed"] [keepAfterSuccess=remove] [taskID=1693302718152315000] [takeTime=104.744µs] []
[2023/08/29 16:51:59.063 +07:00] [INFO] [restore.go:489] ["the whole procedure completed"] [takeTime=901.210837ms] []
[2023/08/29 16:51:59.063 +07:00] [INFO] [main.go:106] ["tidb lightning exit"] [finished=true]
